<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Guest Registration - Swan Solution</title>
  <link rel="stylesheet" href="style1.css" />
</head>
<body>
  <main class="container">
    <h1>Guest Registration Form</h1>

    <form id="guestForm" novalidate>
      <div class="field">
        <label for="fullName">Full Name</label>
        <input type="text" id="fullName" name="fullName" placeholder="Enter full name" />
        <span class="error" id="err-fullName"></span>
      </div>

      <div class="field">
        <label for="phone">Phone Number</label>
        <input type="tel" id="phone" name="phone" placeholder="10 digit phone number" maxlength="10" />
        <span class="error" id="err-phone"></span>
      </div>

      <div class="field">
        <label for="email">Email Address</label>
        <input type="email" id="email" name="email" placeholder="example@domain.com" />
        <span class="error" id="err-email"></span>
      </div>

      <div class="field">
        <label for="aadhar">Aadhar Card Number</label>
        <input type="text" id="aadhar" name="aadhar" placeholder="12 digit Aadhar number" maxlength="12" />
        <span class="error" id="err-aadhar"></span>
      </div>

      <div class="field">
        <label for="checkin">Check In date</label>
        <input type="date" id="checkin" name="checkin" />
        <span class="error" id="err-checkin"></span>
      </div>

      <div class="field">
        <label for="checkout">Check Out date</label>
        <input type="date" id="checkout" name="checkout" />
        <span class="error" id="err-checkout"></span>
      </div>

      <div class="field">
        <label for="purpose">Purpose of visit</label>
        <input type="text" id="purpose" name="purpose" placeholder="e.g., Business / Leisure" />
        <span class="error" id="err-purpose"></span>
      </div>

      <div class="buttons">
        <button type="submit" id="submitBtn">Submit</button>
        <button type="reset" id="resetBtn">Reset</button>
        <a href="view.html" class="view-link">View Submissions</a>
      </div>

      <div id="formMessage" class="message" aria-live="polite"></div>
    </form>
  </main>

  <script>

    (function() {
      const form = document.getElementById('guestForm');
      const messageBox = document.getElementById('formMessage');

      function setError(id, text) {
        document.getElementById('err-' + id).textContent = text || '';
      }

      function clearErrors() {
        ['fullName','phone','email','aadhar','checkin','checkout','purpose']
          .forEach(id => setError(id, ''));
      }

      function validate(formData) {
        clearErrors();
        let ok = true;

        const requiredFields = ['fullName','phone','email','aadhar','checkin','checkout','purpose'];
        requiredFields.forEach(field => {
          if (!formData.get(field) || formData.get(field).toString().trim() === '') {
            setError(field, 'This field is required.');
            ok = false;
          }
        });

        if (!ok) return false;

        const email = formData.get('email').trim();
        const emailRe = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRe.test(email)) {
          setError('email','Enter a valid email.');
          ok = false;
        }

        const phone = formData.get('phone').trim();
        if (!/^\d{10}$/.test(phone)) {
          setError('phone','Phone must be exactly 10 digits.');
          ok = false;
        }

        const aadhar = formData.get('aadhar').trim();
        if (!/^\d{12}$/.test(aadhar)) {
          setError('aadhar','Aadhar must be exactly 12 digits.');
          ok = false;
        }

        return ok;
      }

      function saveSubmission(dataObj) {
        const key = 'guestSubmissions';
        const raw = localStorage.getItem(key);
        let list = [];
        try {
          list = raw ? JSON.parse(raw) : [];
          if (!Array.isArray(list)) list = [];
        } catch(e) {
          list = [];
        }
        list.push(dataObj);
        localStorage.setItem(key, JSON.stringify(list));
      }

      document.getElementById('resetBtn').addEventListener('click', function() {
        clearErrors();
        messageBox.textContent = '';
      });

      form.addEventListener('submit', function(e) {
        e.preventDefault();
        messageBox.textContent = '';
        const fd = new FormData(form);

        if (!validate(fd)) {
          messageBox.textContent = 'Please fix the errors above.';
          messageBox.className = 'message error-msg';
          return;
        }

        const submission = {
          fullName: fd.get('fullName').trim(),
          phone: fd.get('phone').trim(),
          email: fd.get('email').trim(),
          aadhar: fd.get('aadhar').trim(),
          checkin: fd.get('checkin'),
          checkout: fd.get('checkout'),
          purpose: fd.get('purpose').trim(),
          submittedAt: new Date().toISOString()
        };

        try {
          saveSubmission(submission);
          messageBox.textContent = 'Data saved successfully.';
          messageBox.className = 'message success-msg';

          form.reset();
          clearErrors();
        } catch (err) {
          messageBox.textContent = 'Error saving data.';
          messageBox.className = 'message error-msg';
        }
      });
    })();
  </script>
</body>
</html>
